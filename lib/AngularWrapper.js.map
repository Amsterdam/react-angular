{"version":3,"sources":["../src/AngularWrapper.jsx"],"names":["AngularWrapper","state","angularActive","component","buildAngularComponent","props","bindings","interpolateBindings","allBindings","angularAttributes","Object","keys","reduce","acc","key","setAngularApp","angularApp","setComponent","angularComponent","$rootScope","$scope","$root","moduleName","dependencies","angular","module","name","directive","run","reactAngularProductionReady","setState","bootstrap","forEach","$digest","$destroy","children","Component","defaultProps","propTypes","PropTypes","element","string","isRequired","arrayOf","shape"],"mappings":"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","file":"AngularWrapper.js","sourcesContent":["import React, { Component, createElement } from 'react';\nimport PropTypes from 'prop-types';\nimport angular from 'angular';\nimport AngularTemplate, { ensureScopeAvailable, reactAngularModule } from './angularTemplate';\nimport camelCaseToDash from './utils/camelCaseToDash';\n\nclass AngularWrapper extends Component {\n  state = {\n    angularActive: false,\n  };\n\n  component = null;\n\n  componentWillMount() {\n    const { component } = this.props;\n    if (component) {\n      this.buildAngularComponent();\n    }\n  }\n\n  componentDidMount() {\n    const { moduleName, dependencies } = this.props;\n\n    angular\n      .module(`${moduleName}`, [...dependencies, reactAngularModule(false).name])\n      .directive('exposeScope', () => ensureScopeAvailable())\n      .run((reactAngularProductionReady) => {\n        reactAngularProductionReady();\n        this.setState({ angularActive: true });\n      });\n    angular.bootstrap(this.angularApp, [moduleName]);\n  }\n\n  componentDidUpdate() {\n    const { bindings, interpolateBindings } = this.props;\n    if (!this.angularComponent) {\n      return;\n    }\n    const allBindings = { ...bindings, ...interpolateBindings };\n    Object.keys(allBindings).forEach((key) => {\n      this.angularComponent.$scope[key] = allBindings[key];\n    });\n    this.angularComponent.$scope.$digest();\n  }\n\n  componentWillUnmount() {\n    if (this.$rootScope) {\n      this.setState({ angularActive: false });\n      this.$rootScope.$destroy();\n    }\n  }\n\n  buildAngularComponent = () => {\n    const { bindings, interpolateBindings, component } = this.props;\n    const allBindings = { ...bindings, ...interpolateBindings };\n    const angularAttributes = Object.keys(allBindings).reduce((acc, key) => {\n      acc[camelCaseToDash(key)] = (key in interpolateBindings) ? `{{${key}}}` : key;\n      return acc;\n    }, {});\n\n    this.component = createElement(camelCaseToDash(component), angularAttributes);\n  };\n\n  setAngularApp = (angularApp) => {\n    if (angularApp) {\n      this.angularApp = angularApp;\n    }\n  };\n\n  setComponent = (component) => {\n    if (component) {\n      this.angularComponent = component;\n      this.$rootScope = this.angularComponent.$scope.$root;\n    }\n  };\n\n  render() {\n    const { interpolateBindings, bindings, children } = this.props;\n    const { angularActive } = this.state;\n\n    return (\n      <div\n        ref={this.setAngularApp}\n      >\n        {\n          angularActive && (\n            <AngularTemplate\n              scope={{ ...interpolateBindings, ...bindings }}\n              ref={this.setComponent}\n            >\n              {this.component ? this.component : children}\n            </AngularTemplate>\n          )\n        }\n      </div>\n    );\n  }\n}\n\nAngularWrapper.defaultProps = {\n  dependencies: [],\n  children: null,\n  component: null,\n  bindings: {},\n  interpolateBindings: {},\n};\n\nAngularWrapper.propTypes = {\n  children: PropTypes.element,\n  component: PropTypes.string,\n  moduleName: PropTypes.string.isRequired,\n  dependencies: PropTypes.arrayOf(PropTypes.string),\n  bindings: PropTypes.shape({}),\n  interpolateBindings: PropTypes.shape({}),\n};\n\nexport default AngularWrapper;\n"]}