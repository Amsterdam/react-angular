{"version":3,"sources":["../src/AngularWrapper.jsx"],"names":["AngularWrapper","state","angularActive","angularComponent","buildAngularComponent","props","bindings","interpolateBindings","component","children","allBindings","angularAttributes","Object","keys","reduce","acc","key","setRootRef","angularApp","rootRef","setAngularRef","ref","angularRef","moduleName","dependencies","angularInstance","module","name","directive","run","reactAngularProductionReady","setState","bootstrap","strictDi","forEach","$scope","setTimeout","$digest","$root","$destroy","Component","defaultProps","propTypes","PropTypes","oneOfType","arrayOf","node","string","isRequired","shape","any"],"mappings":"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","file":"AngularWrapper.js","sourcesContent":["import React, { Component, createElement } from 'react';\nimport PropTypes from 'prop-types';\nimport AngularTemplate, { ensureScopeAvailable, reactAngularModule } from './angularTemplate';\nimport camelCaseToDash from './utils/camelCaseToDash';\n\nclass AngularWrapper extends Component {\n  state = {\n    angularActive: false,\n  };\n\n  angularComponent = null;\n\n  componentDidMount() {\n    const { moduleName, component, dependencies, angularInstance } = this.props;\n    if (component) {\n      this.buildAngularComponent();\n    }\n    angularInstance\n      .module(moduleName, [...dependencies, reactAngularModule(angularInstance, false).name])\n      .directive('exposeScope', () => ensureScopeAvailable())\n      .run([\n        'reactAngularProductionReady',\n        (reactAngularProductionReady) => {\n          reactAngularProductionReady();\n          this.setState({ angularActive: true });\n        },\n      ]);\n    angularInstance.bootstrap(this.rootRef, [moduleName], { strictDi: true });\n  }\n\n  componentDidUpdate() {\n    const { bindings, interpolateBindings } = this.props;\n    if (!this.angularRef) {\n      return;\n    }\n    const allBindings = { ...bindings, ...interpolateBindings };\n    Object.keys(allBindings).forEach((key) => {\n      this.angularRef.$scope[key] = allBindings[key];\n    });\n    setTimeout(() => {\n      this.angularRef.$scope.$digest();\n    });\n  }\n\n  componentWillUnmount() {\n    if (this.angularRef.$scope.$root) {\n      this.setState({ angularActive: false });\n      this.angularRef.$scope.$root.$destroy();\n    }\n  }\n\n  buildAngularComponent = () => {\n    const {\n      bindings,\n      interpolateBindings,\n      component,\n      children,\n    } = this.props;\n\n    const allBindings = { ...bindings, ...interpolateBindings };\n    const angularAttributes = Object.keys(allBindings).reduce((acc, key) => {\n      acc[camelCaseToDash(key)] = (key in interpolateBindings) ? `{{${key}}}` : key;\n      return acc;\n    }, {});\n\n    this.angularComponent = createElement(camelCaseToDash(component), angularAttributes, children);\n  };\n\n  setRootRef = (angularApp) => {\n    if (angularApp) {\n      this.rootRef = angularApp;\n    }\n  };\n\n  setAngularRef = (ref) => {\n    if (ref) {\n      this.angularRef = ref;\n    }\n  };\n\n  render() {\n    const { interpolateBindings, bindings, children, angularInstance } = this.props;\n    const { angularActive } = this.state;\n\n    return (\n      <div\n        ref={this.setRootRef}\n      >\n        {\n          angularActive && (\n            <AngularTemplate\n              angularInstance={angularInstance}\n              scope={{ ...interpolateBindings, ...bindings }}\n              ref={this.setAngularRef}\n            >\n              {this.angularComponent ? this.angularComponent : children}\n            </AngularTemplate>\n          )\n        }\n      </div>\n    );\n  }\n}\n\nAngularWrapper.defaultProps = {\n  dependencies: [],\n  children: null,\n  component: null,\n  bindings: {},\n  interpolateBindings: {},\n};\n\nAngularWrapper.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node,\n  ]),\n  component: PropTypes.string,\n  moduleName: PropTypes.string.isRequired,\n  dependencies: PropTypes.arrayOf(PropTypes.string),\n  bindings: PropTypes.shape({}),\n  interpolateBindings: PropTypes.shape({}),\n  // eslint-disable-next-line react/forbid-prop-types,react/require-default-props\n  angularInstance: PropTypes.any,\n};\n\nexport default AngularWrapper;\n"]}