{"version":3,"sources":["../src/AngularWrapper.jsx"],"names":["AngularWrapper","state","angularActive","angularComponent","buildAngularComponent","props","bindings","interpolateBindings","component","children","allBindings","angularAttributes","Object","keys","reduce","acc","key","setRootRef","angularApp","rootRef","setAngularRef","ref","angularRef","moduleName","dependencies","angular","module","name","directive","run","reactAngularProductionReady","setState","bootstrap","forEach","$scope","setTimeout","$digest","$root","$destroy","Component","defaultProps","propTypes","PropTypes","oneOfType","arrayOf","node","string","isRequired","shape"],"mappings":"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","file":"AngularWrapper.js","sourcesContent":["import React, { Component, createElement } from 'react';\nimport PropTypes from 'prop-types';\nimport angular from 'angular';\nimport AngularTemplate, { ensureScopeAvailable, reactAngularModule } from './angularTemplate';\nimport camelCaseToDash from './utils/camelCaseToDash';\n\nclass AngularWrapper extends Component {\n  state = {\n    angularActive: false,\n  };\n\n  angularComponent = null;\n\n  componentWillMount() {\n    const { component } = this.props;\n    if (component) {\n      this.buildAngularComponent();\n    }\n  }\n\n  componentDidMount() {\n    const { moduleName, dependencies } = this.props;\n    angular\n      .module(`${moduleName}`, [...dependencies, reactAngularModule(false).name])\n      .directive('exposeScope', () => ensureScopeAvailable())\n      .run((reactAngularProductionReady) => {\n        reactAngularProductionReady();\n        this.setState({ angularActive: true });\n      });\n    angular.bootstrap(this.rootRef, [moduleName]);\n  }\n\n  componentDidUpdate() {\n    const { bindings, interpolateBindings } = this.props;\n    if (!this.angularRef) {\n      return;\n    }\n    const allBindings = { ...bindings, ...interpolateBindings };\n    Object.keys(allBindings).forEach((key) => {\n      this.angularRef.$scope[key] = allBindings[key];\n    });\n    setTimeout(() => {\n      this.angularRef.$scope.$digest();\n    });\n  }\n\n  componentWillUnmount() {\n    if (this.angularRef.$scope.$root) {\n      this.setState({ angularActive: false });\n      this.angularRef.$scope.$root.$destroy();\n    }\n  }\n\n  buildAngularComponent = () => {\n    const {\n      bindings,\n      interpolateBindings,\n      component,\n      children,\n    } = this.props;\n\n    const allBindings = { ...bindings, ...interpolateBindings };\n    const angularAttributes = Object.keys(allBindings).reduce((acc, key) => {\n      acc[camelCaseToDash(key)] = (key in interpolateBindings) ? `{{${key}}}` : key;\n      return acc;\n    }, {});\n\n    this.angularComponent = createElement(camelCaseToDash(component), angularAttributes, children);\n  };\n\n  setRootRef = (angularApp) => {\n    if (angularApp) {\n      this.rootRef = angularApp;\n    }\n  };\n\n  setAngularRef = (ref) => {\n    if (ref) {\n      this.angularRef = ref;\n    }\n  };\n\n  render() {\n    const { interpolateBindings, bindings, children } = this.props;\n    const { angularActive } = this.state;\n\n    return (\n      <div\n        ref={this.setRootRef}\n      >\n        {\n          angularActive && (\n            <AngularTemplate\n              scope={{ ...interpolateBindings, ...bindings }}\n              ref={this.setAngularRef}\n            >\n              {this.angularComponent ? this.angularComponent : children}\n            </AngularTemplate>\n          )\n        }\n      </div>\n    );\n  }\n}\n\nAngularWrapper.defaultProps = {\n  dependencies: [],\n  children: null,\n  component: null,\n  bindings: {},\n  interpolateBindings: {},\n};\n\nAngularWrapper.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node,\n  ]),\n  component: PropTypes.string,\n  moduleName: PropTypes.string.isRequired,\n  dependencies: PropTypes.arrayOf(PropTypes.string),\n  bindings: PropTypes.shape({}),\n  interpolateBindings: PropTypes.shape({}),\n};\n\nexport default AngularWrapper;\n"]}